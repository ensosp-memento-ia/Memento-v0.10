<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>MÃ©mento IA â€“ ENSOSP | CrÃ©ation de fiche</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Police Inter -->
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css">

  <!-- Styles ENSOSP -->
  <link rel="stylesheet" href="style.css" />

  <!-- Lib compression / QR code -->
  <script src="https://unpkg.com/pako@2.1.0/dist/pako.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>

<body>

  <!-- ========================================================= -->
  <!-- BARRE D'ONGLETS -->
  <!-- ========================================================= -->
  <nav class="tabs">
    <a href="index.html" class="tab">ğŸ  Accueil</a>
    <a href="scan.html" class="tab">ğŸ“· Lecture QR</a>
    <a class="tab active">ğŸ“ CrÃ©ation</a>
  </nav>

  <!-- ========================================================= -->
  <!-- NAVIGATION RAPIDE SECTIONS -->
  <!-- ========================================================= -->
  <nav class="section-nav">
    <a href="#section-meta" class="nav-btn">ğŸ“‹ Informations</a>
    <a href="#section-ai" class="nav-btn">ğŸ¤–Cotation IA</a>
    <a href="#section-vars" class="nav-btn">ğŸ”¢ Variables</a>
    <a href="#section-prompt" class="nav-btn">âœï¸ Prompt</a>
    <a href="#section-qr" class="nav-btn">ğŸ“± QR Code</a>
  </nav>

  <main>

    <h1 class="page-title">CrÃ©ation de fiche opÃ©rationnelle IA</h1>

    <!-- Bouton rÃ©initialiser -->
    <button id="btnReset" class="btn-reset">ğŸ”„ RÃ©initialiser tout</button>

    <!-- ========================================================= -->
    <!-- SECTION METADONNÃ‰ES -->
    <!-- ========================================================= -->
    <section class="card" id="section-meta">
      <h2>1. MÃ©tadonnÃ©es de la fiche</h2>

      <label>CatÃ©gorie
        <input id="meta_categorie" type="text" placeholder="Ex : Risque chimique">
      </label>

      <label>Titre de la fiche
        <input id="meta_titre" type="text" placeholder="Ex : Analyse initiale site RCH">
      </label>

      <label>Objectif
        <input id="meta_objectif" type="text" placeholder="Ex : Aide RCH3/RCH4 analyse rapide">
      </label>

      <label>Concepteur
        <input id="meta_concepteur" type="text" placeholder="Ex : Cdt Tirelle">
      </label>

      <!-- âœ… Version et Date sur mÃªme ligne -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
        <label>Version
          <input id="meta_version" type="text" placeholder="Ex : 1.0" value="1.0">
        </label>

        <label>Date de mise Ã  jour
          <input id="meta_date" type="date">
        </label>
      </div>
    </section>

    <!-- ========================================================= -->
    <!-- INDICES DE CONFIANCE IA -->
    <!-- ========================================================= -->
    <section class="card" id="section-ai">
      <h2>2. Indices de confiance IA</h2>

      <label>ChatGPT
        <select id="aiChatGPT" class="indice-confiance">
          <option value="3">3 - RecommandÃ©e</option>
          <option value="2">2 - Acceptable</option>
          <option value="1">1 - Non recommandÃ©e</option>
        </select>
      </label>

      <label>Perplexity
        <select id="aiPerplexity" class="indice-confiance">
          <option value="3">3 - RecommandÃ©e</option>
          <option value="2">2 - Acceptable</option>
          <option value="1">1 - Non recommandÃ©e</option>
        </select>
      </label>

      <label>Mistral
        <select id="aiMistral" class="indice-confiance">
          <option value="3">3 - RecommandÃ©e</option>
          <option value="2">2 - Acceptable</option>
          <option value="1">1 - Non recommandÃ©e</option>
        </select>
      </label>
    </section>

    <!-- ========================================================= -->
    <!-- VARIABLES -->
    <!-- ========================================================= -->
    <section class="card" id="section-vars">
      <h2>3. Variables du prompt (max 10)</h2>

      <p class="helper">
        Variable ID <b>code_onu</b> â†’ <code>{{code_onu}}</code> dans le prompt
      </p>

      <div id="variablesContainer"></div>

      <button id="btnAddVariable" class="btn-add-var">â• Ajouter une variable</button>
    </section>


    <!-- ========================================================= -->
    <!-- PROMPT -->
    <!-- ========================================================= -->
    <section class="card" id="section-prompt">
      <h2>4. RÃ©daction du prompt</h2>
      <p class="helper">
        Limite : <strong>4000 caractÃ¨res</strong> aprÃ¨s compactage.<br>
        Utilisez les variables avec <code>{{identifiant}}</code>.
      </p>

      <textarea id="prompt_input" rows="10" placeholder="RÃ©digez le prompt iciâ€¦"></textarea>
      <div id="prompt_count" class="counter">0 / 4000</div>
    </section>

    <!-- ========================================================= -->
    <!-- GENERATION DU QR CODE -->
    <!-- ========================================================= -->
    <section class="card" id="section-qr">
      <h2>5. GÃ©nÃ©ration du QR Code</h2>

      <button id="btnGenerate" class="btn-generate">ğŸš€ GÃ©nÃ©rer JSON + QR code</button>

      <div id="qrContainer" class="qr-box"></div>

      <!-- âœ… Nouveau : GÃ©nÃ©ration de lien cliquable -->
      <div id="linkContainer" style="margin-top:20px;display:none;">
        <h3 style="color:#001F8F;font-size:16px;margin-bottom:10px;">ğŸ”— Lien cliquable pour PDF</h3>
        <input 
          id="ficheUrl" 
          type="text" 
          readonly 
          style="width:100%;padding:10px;border:2px solid #001F8F;border-radius:8px;font-size:13px;background:#f9f9f9;"
          placeholder="Le lien apparaÃ®tra ici..."
        >
        <button id="btnCopyLink" class="btn-add-var" style="margin-top:10px;">ğŸ“‹ Copier le lien</button>
        <p style="font-size:13px;color:#666;margin-top:10px;">
          ğŸ’¡ <b>Utilisation :</b> Collez ce lien dans votre PDF. Quand on clique dessus, la fiche s'ouvre automatiquement dans l'application.
        </p>
      </div>

    </section>

  </main>


  <!-- ========================================================= -->
  <!-- SCRIPTS UI -->
  <!-- ========================================================= -->
  <script type="module" src="./src/ui/createFiche.js"></script>

</body>
</html>
